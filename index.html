<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Leo &amp; Zoe çš„å°å®‡å®™ Â· æ¬¢è¿å›å®¶</title>
<style>
  :root{
    --pink:#EB55BF;
    --violet:#B292EA;
    --sky:#8BDBF5;
    --milk:#F1FFD9;
    --ink:#2e2e3a;
    --card:#ffffffee;
    --shadow:0 8px 24px rgba(0,0,0,.08);
    --radius:18px;
  }
  html,body{
    height:100%;
    margin:0;
    background: radial-gradient(60% 60% at 50% 0%, var(--pink) 0%, var(--violet) 55%, var(--sky) 85%, var(--milk) 100%);
    font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC","Hiragino Sans GB","Microsoft YaHei", "Noto Sans CJK SC", sans-serif;
    color: var(--ink);
  }
  .stars{
    position: fixed;
    inset:0;
    pointer-events:none;
    overflow:hidden;
    z-index:0;
  }
  .star{
    position:absolute;
    width:6px; height:6px;
    border-radius:50%;
    background: #fff;
    box-shadow:0 0 12px #fff, 0 0 24px #fff;
    opacity:.7;
    animation: float 18s linear infinite;
  }
  @keyframes float{
    0%   { transform: translateY(110vh) translateX(0) scale(.8); opacity:.0; }
    10%  {opacity:.9;}
    100% { transform: translateY(-10vh) translateX(40px) scale(1.15); opacity:.0; }
  }
  .wrap{
    position:relative;
    z-index:1;
    max-width: 1120px;
    margin: clamp(12px,3vw,28px) auto 64px;
    padding: 16px;
  }
  header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:16px;
    padding:20px 24px;
    background: var(--card);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    backdrop-filter: blur(8px);
  }
  h1{
    margin:0;
    font-size: clamp(22px, 3vw, 32px);
    letter-spacing:.5px;
  }
  .subtitle{ opacity:.75; font-weight:600 }
  .grid{
    margin-top:18px;
    display:grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 16px;
  }
  .card{
    grid-column: span 4;
    background: var(--card);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 16px 18px;
    min-height: 120px;
  }
  .card.wide{ grid-column: span 12; }
  .card.half{ grid-column: span 6; }
  .kicker{font-size:12px; letter-spacing:1px; text-transform:uppercase; opacity:.6}
  .title{margin:6px 0 10px; font-weight:700}
  .row{display:flex; align-items:center; gap:10px; flex-wrap:wrap;}
  .muted{opacity:.6}
  .emoji-choice{
    display:flex; gap:10px; flex-wrap:wrap; margin-top:4px;
  }
  .emoji{
    font-size: 24px; line-height: 42px; width:42px; height:42px; text-align:center;
    border-radius:12px; background:#fff; box-shadow: inset 0 0 0 2px rgba(0,0,0,.06);
    cursor:pointer; user-select:none; transition:.15s transform;
  }
  .emoji:hover{ transform: translateY(-2px) scale(1.02); }
  .emoji.active{ box-shadow: inset 0 0 0 2px var(--violet), 0 8px 18px rgba(178,146,234,.24) }
  .input, .button{
    height:40px; border-radius:12px; border:1px solid rgba(0,0,0,.08);
    padding: 0 12px; background:#fff; outline:none;
  }
  .button{
    background:linear-gradient(135deg, var(--violet), var(--pink));
    color:#fff; border:none; font-weight:700; cursor:pointer; padding:0 16px;
    box-shadow: 0 8px 20px rgba(235,85,191,.28);
  }
  .button:active{ transform: translateY(1px); }
  .gallery{
    display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; margin-top:8px;
  }
  .thumb{
    width:100%; aspect-ratio:1/1; object-fit:cover; border-radius:12px; box-shadow:0 8px 18px rgba(0,0,0,.08);
  }
  /* Chat */
  .chatbox{ max-height: 340px; overflow:auto; padding-right:6px; display:flex; flex-direction:column; gap:10px; }
  .bubble{ max-width:72%; padding:12px 14px; border-radius:16px; line-height:1.4; word-wrap: break-word; }
  .me{ align-self:flex-end; background: #E8E3FF; }
  .leo{ align-self:flex-start; background:#fff; }
  .tag{ font-size:12px; opacity:.6; margin:0 8px; }
  .row-end{ margin-top:8px; gap:8px; }
  .footer{
    margin-top: 18px;
    display:flex; align-items:center; justify-content:space-between; gap:12px;
  }
  .counter{ font-weight:700 }

  /* ç•™è¨€æ¿å¼¹çª—æ ·å¼ */
  #messageBoardPopup {
    display: none;
    position: fixed;
    top: 10%;
    left: 50%;
    transform: translateX(-50%);
    background: repeating-linear-gradient(45deg, #f4e2d8, #f4e2d8 10px, #eacbb4 10px, #eacbb4 20px);
    border: 5px solid #d2a679;
    border-radius: 12px;
    padding: 20px;
    width: 80%;
    max-width: 600px;
    z-index: 999;
    box-shadow: 0 0 15px rgba(0,0,0,0.3);
    max-height: 70vh;
    overflow-y: auto;
  }

  /* ç•™è¨€æ ‡ç­¾æ ·å¼ */
  .message-tag {
    position: relative;
    margin: 10px 0;
    padding: 12px 16px;
    border-radius: 8px;
    width: fit-content;
    max-width: 80%;
    font-size: 14px;
    line-height: 1.4;
    word-break: break-word;
    background-image: linear-gradient(135deg, #fddde6 25%, #ffeef2 100%);
    box-shadow: 2px 2px 6px rgba(0,0,0,0.1);
    border: 1px dashed #fcb8d2;
  }
  .message-tag.leo {
    background-image: linear-gradient(135deg, #d0ecff 25%, #e7f5ff 100%);
    border: 1px dashed #90c7e3;
  }
  .message-author { font-weight: bold; margin-bottom: 5px; display: block; color: #444; }
  .message-content { white-space: pre-wrap; }

  /* æ—¥è®°æœ¬æ¨¡æ€æ¡†æ ·å¼ */
  #diaryModal {
    font-family: 'Comic Sans MS', 'Arial', cursive;
    background: linear-gradient(135deg, #ffd1dc 0%, #ffb6c1 100%);
    border-radius: 20px;
    padding: 25px;
    box-shadow: 0 10px 25px rgba(255, 105, 180, 0.3);
    color: #6a2c70;
    border: 8px double #ff69b4;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 85%;
    max-width: 700px;
    height: auto;
    max-height: 85vh;
    overflow: auto;
    z-index: 1000;
    display:none;
  }
  #diaryModal h2 { color: #d23669; text-align: center; margin-bottom: 20px; font-size: 28px; text-shadow: 2px 2px 4px rgba(255,255,255,0.5); }
  #diaryDate, #diaryText {
    width: 100%;
    border: 2px dashed #ff69b4; border-radius: 10px; background-color: #fffafd;
    font-family: 'Comic Sans MS', 'Arial', cursive; font-size: 16px; color: #6a2c70;
  }
  #diaryDate { padding: 12px; margin-bottom: 15px; }
  #diaryText { height: 300px; padding: 15px; resize: vertical; box-shadow: inset 0 0 10px rgba(255, 182, 193, 0.5); }
  #diaryModal button{
    font-family: 'Comic Sans MS', 'Arial', cursive; background: linear-gradient(135deg, #ff69b4, #ff85a2);
    color: white; border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: bold;
    margin: 5px; box-shadow: 0 4px 8px rgba(255, 105, 180, 0.3); transition: all 0.3s ease;
  }
  #diaryModal button:hover{ transform: translateY(-2px); box-shadow: 0 6px 12px rgba(255,105,180,0.4); background: linear-gradient(135deg, #ff85a2, #ff69b4); }

  @media (max-width: 980px){
    .card{ grid-column: span 12; }
    .card.half{ grid-column: span 12; }
    .gallery{ grid-template-columns: repeat(2, 1fr); }
  }

  /* è®¸æ„¿æ± æ ·å¼ */
  #wishingPoolOverlay {
    display:none; position:fixed; top:0; left:0; width:100%; height:100%;
    background:linear-gradient(to top, #0b0c2a, #1c1f4a); z-index:9999; overflow:hidden;
    font-family:'Helvetica Neue', sans-serif;
  }
  #wishDetailPopup {
    display:none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
    background: white; padding: 20px; border-radius: 8px; width: 300px; z-index: 10000;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
  }
  .wish-status-options { margin: 10px 0; }
  .wish-status-options label { display:block; margin:5px 0; }
  .close-btn { position:absolute; top: 8px; right: 12px; font-size: 20px; cursor: pointer; color: #333; background:none; border:none; }

  /* å°å® ç‰©å¼¹çª— */
  #petPopup { display:none; position: fixed; top: 10%; left: 50%; transform: translateX(-50%);
    background: #ffe5b4; border-radius: 12px; padding: 20px; width: 80%; max-width: 600px; z-index: 999;
    box-shadow: 0 0 15px rgba(0,0,0,0.3); text-align: center; }
  #petPopup img { width: 50%; border-radius: 50%; }
  #petPopup button { background: #ff69b4; color: white; padding: 10px 20px; border-radius: 8px; border:none; cursor:pointer; margin-top: 20px; transition: .3s; }
  #petPopup button:hover { background: #ff85c4; }

  /* ç›¸å†Œå¼¹çª— */
  #albumPopup { display:none; position: fixed; top: 10%; left: 50%; transform: translateX(-50%);
    background: #f0e5de; border-radius: 12px; padding: 20px; width: 80%; max-width: 600px; z-index: 999;
    box-shadow: 0 0 15px rgba(0,0,0,0.3); }
  .album-gallery { display:grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
  .album-gallery img { width: 100%; height: 200px; object-fit: cover; border-radius: 12px; }
  .album-gallery img:hover { opacity: .8; }

  /* â€”â€” æ–°å¢ï¼šç§å¯†ç©ºé—´ï¼ˆæš—è‰²é£ï¼‰ â€”â€” */
  #secretModal{
    display:none;
    position: fixed;
    top: 50%; left: 50%; transform: translate(-50%, -50%);
    width: 88%; max-width: 720px;
    background: radial-gradient(120% 120% at 0% 0%, #0e1027 0%, #121430 45%, #191b3f 100%);
    color: #e6e9f7;
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0,0,0,.45);
    z-index: 10001;
    border: 1px solid rgba(120,140,255,.15);
  }
  .secret-card{ padding: 22px; position: relative; }
  .secret-title{ margin: 0 0 10px; font-size: 20px; letter-spacing:.5px; }
  .secret-sub{ opacity:.7; font-size: 14px; margin-bottom: 12px; }
  .secret-close{
    position:absolute; top:10px; right:12px;
    width:36px; height:36px; border-radius:10px; border:1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.04); color:#fff; cursor:pointer;
  }
  .secret-input, .secret-btn{
    height:40px; border-radius:12px; border:1px solid rgba(255,255,255,.14);
    padding: 0 12px; outline:none;
  }
  .secret-input{ background: rgba(255,255,255,.06); color:#fff; width: 200px; }
  .secret-btn{ background: linear-gradient(135deg, #6a6ffb, #b06af7); color:#fff; font-weight:700; cursor:pointer; padding:0 16px; }
  .secret-lock{
    margin-left:auto; background: linear-gradient(135deg, #ff6b6b, #ff9770);
    color:#fff; border:none; height:36px; padding: 0 14px; border-radius:10px; cursor:pointer;
  }
  .secret-bar{ display:flex; align-items:center; gap:10px; margin: 6px 0 16px; }
  .secret-list{ max-height: 50vh; overflow:auto; padding-right:6px; display:flex; flex-direction:column; gap:10px; }
  .secret-tag{
    position:relative; width:fit-content; max-width: 82%;
    background: linear-gradient(135deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    border: 1px dashed rgba(130,150,255,.35);
    border-radius: 12px; padding: 12px 14px; box-shadow: 0 12px 26px rgba(0,0,0,.28);
    color:#e9ecff;
  }
  .secret-tag.leo{ border-color: rgba(139,219,245,.55); }
  .secret-tag .author{ font-weight:700; opacity:.9; margin-right:6px; }
  .secret-tag .time{ font-size:12px; opacity:.6; margin-top:6px; }
  .secret-editor{ display:flex; gap:8px; margin-top:10px; align-items:flex-start; }
  .secret-textarea{
    flex:1; min-height:72px; border-radius:12px; background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
    color:#fff; padding:10px; resize:vertical;
  }
  .secret-publish{ background: linear-gradient(135deg, #7bd88f, #4ad1c8); border:none; color:#0e1027;
    font-weight:800; padding: 10px 14px; border-radius:12px; cursor:pointer;
  }
  .shake{ animation: shake .35s both; }
  @keyframes shake{
    20%{ transform: translateX(-4px) } 40%{ transform: translateX(4px) } 60%{ transform: translateX(-3px) } 80%{ transform: translateX(3px) } 100%{ transform: translateX(0) }
  }
</style>
</head>
<body>

<div id="cloudStatus" style="position:fixed;right:12px;bottom:12px;background:#111;color:#fff;padding:8px 10px;border-radius:10px;font-size:12px;z-index:99999;opacity:.9">
  äº‘ç«¯ï¼š<span id="cloudState">æ£€æµ‹ä¸­...</span>
  <div id="cloudMsg" style="max-width:280px;margin-top:4px;opacity:.85"></div>
</div>

<div class="stars" id="stars"></div>
<div class="wrap">
<header>
  <div>
    <h1>Leo &amp; Zoe çš„å°å®‡å®™</h1>
    <div class="subtitle">æ¬¢è¿å›å®¶ âœ¨</div>
  </div>
  <div class="muted" id="now"></div>
</header>

<section class="grid">
  <!-- è¡Œ 1ï¼šå¤©æ°” + å¿ƒæƒ… + å°é‡‘åº“ -->
  <div class="card">
    <div class="kicker">æ²ˆé˜³ Â· å¤©æ°”</div>
    <div class="title" id="weatherTitle">åŠ è½½ä¸­...</div>
    <div class="row muted" id="weatherMeta"></div>
  </div>
  <div class="card">
    <div class="kicker">ä»Šæ—¥å¿ƒæƒ…</div>
    <div class="emoji-choice" id="moods"></div>
    <div class="muted" id="moodSaved"></div>
  </div>
  <div class="card">
    <div class="kicker">å°é‡‘åº“</div>
    <div class="row">
      <input class="input" id="walletInput" placeholder="è¾“å…¥ L å¸..." type="number"/>
      <button class="button" id="walletBtn">ä¿å­˜</button>
    </div>
    <div class="title" style="margin-top:10px">ä½™é¢ï¼š<span id="walletValue">0</span> L</div>

  </div>

  <!-- è¡Œ 2ï¼šå›¾ç‰‡å¢™ -->
  <div class="card wide">
    <div class="kicker">ç…§ç‰‡å¢™</div>
    <div class="row">
      <input accept="image/*" class="input" id="uploader" multiple type="file"/>
      <button class="button" id="clearPhotos">æ¸…ç©º</button>
    </div>
    <div class="gallery" id="gallery"></div>
  </div>

  <!-- è¡Œ 3ï¼šå…¥å£æŒ‰é’® -->
  <div class="card half">
    <div class="kicker">å°ä¸–ç•Œ</div>
    <div class="row row-end">
      <button class="button" onclick="openDiaryModal()">æ—¥è®°æœ¬</button>
      <button class="button" onclick="openAlbumPopup()">ç›¸å†Œ</button>
      <button class="button" id="messageBoardBtn" onclick="openMessageBoard()">ç•™è¨€æ¿</button>
      <button class="button" onclick="openWishingPool()">è®¸æ„¿æ± </button>
      <button class="button" onclick="openPetPopup()">å°å® ç‰©</button>
      <!-- ä¿®æ”¹ï¼šåŸæ¥ toast('ç§å¯†ç©ºé—´ä¼šåŠ é”ğŸ”’') æ”¹ä¸ºæ‰“å¼€å¼¹çª— -->
      <button class="button" onclick="openSecretModal()">ç§å¯†ç©ºé—´</button>
    </div>
  </div>

  <!-- è¡Œ 3ï¼šå’Œ Leo èŠå¤© -->
  <div class="card half" id="chatArea">
    <div class="kicker">å’Œ Leo èŠå¤©ï¼ˆæœ¬åœ°å°æœºå™¨äººï¼‰</div>
    <div class="chatbox" id="chat"></div>
    <div class="row row-end">
      <input class="input" id="chatInput" placeholder="ä»Šå¤©æƒ³æˆ‘äº†å—..." style="flex:1"/>
      <button class="button" id="chatSend">å‘é€</button>
    </div>
  </div>

  <!-- è¡Œ 4ï¼šåœ¨ä¸€èµ·å¤©æ•° -->
  <div class="card wide">
    <div class="kicker">çºªå¿µ</div>
    <div class="title">Leo å’Œ Zoe å·²ç»åœ¨ä¸€èµ· <span class="counter" id="daysTogether">0</span> å¤©å•¦ ï½</div>
  </div>
</section>
</div>

<!-- ç•™è¨€æ¿å¼¹çª— -->
<div class="popup" id="messageBoardPopup">
  <div class="popup-content" style="background: url('https://www.transparenttextures.com/patterns/cork-board.png'); border: 5px solid #deb887; padding: 20px; border-radius: 15px;">
    <h2 style="text-align: center;">ç•™è¨€æ¿</h2>
    <div class="messages-container" id="messagesContainer"></div>
    <textarea id="messageInput" placeholder="å†™ç‚¹ä»€ä¹ˆ..." rows="3"></textarea>
    <div class="button-container">
      <button onclick="postMessage('Zoe')">Zoeçš„ç•™è¨€</button>
      <button onclick="postMessage('Leo')">Leoçš„ç•™è¨€</button>
    </div>
    <button class="close-button" onclick="closeMessageBoard()">å…³é—­</button>
  </div>
</div>

<!-- æ—¥è®°æœ¬æ¨¡æ€æ¡† -->
<div id="diaryModal">
  <div style="text-align:center; margin-bottom:20px;">
    <h2>ğŸŒ¸ æ—¥è®°æœ¬ ğŸŒ¸</h2>
  </div>
  <div style="margin-bottom:15px;">
    <label style="font-weight:bold; color:#d23669;">é€‰æ‹©æ—¥æœŸï¼š</label>
    <input id="diaryDate" type="date"/>
  </div>
  <div style="margin-bottom:20px;">
    <label style="font-weight:bold; color:#d23669;">å†™ä¸‹ä»Šå¤©çš„å¿ƒæƒ…ï¼š</label>
    <textarea id="diaryText" placeholder="ä»Šå¤©æœ‰ä»€ä¹ˆæƒ³è®°å½•çš„å‘¢... ğŸ’•"></textarea>
  </div>
  <div style="text-align:center;">
    <button onclick="saveDiary()">ğŸ’¾ ä¿å­˜æ—¥è®°</button>
    <button onclick="closeDiaryModal()">âŒ å…³é—­</button>
  </div>
</div>

<template id="message-template">
  <div class="message-tag">
    <div class="message-author"></div>
    <div class="message-text"></div>
    <div class="reply-container">
      <textarea class="reply-input" placeholder="å›å¤..."></textarea>
      <button class="reply-button">å›å¤</button>
    </div>
    <div class="replies"></div>
  </div>
</template>

<!-- è®¸æ„¿æ± å¼¹çª—åŒºåŸŸ -->
<div id="wishingPoolOverlay">
  <h1 style="text-align:center; margin-top:20px; font-size:2em; color:white;">ğŸŒ™ è®¸æ„¿æ± </h1>
  <div style="display:flex; justify-content:center; margin-top:20px;">
    <input id="wishInput" placeholder="åœ¨è¿™é‡Œå†™ä¸‹ä½ çš„æ„¿æœ›..." style="width:300px; padding:10px; border-radius:8px; border:none; font-size:1em;" type="text"/>
    <button id="addWish" style="padding:10px 15px; margin-left:10px; font-size:1em; background-color:#4b6cb7; border:none; border-radius:8px; color:white; cursor:pointer;">æ”¾å…¥ç“¶ä¸­</button>
  </div>
  <div id="pond" style="position:relative; width:100%; height:75vh; margin-top:30px; background:radial-gradient(circle, #1f2a56 0%, #0e1a3f 100%); overflow:hidden;"></div>
  
  <div id="wishDetailPopup">
    <button class="close-btn" onclick="closeWishDetail()">âœ–</button>
    <h2>æ„¿æœ›è¯¦æƒ…</h2>
    <p id="wishContent"></p>
    <div class="wish-status-options">
      <label><input name="status" type="radio" value="è¿›è¡Œä¸­"/> è¿›è¡Œä¸­</label>
      <label><input name="status" type="radio" value="å·²å®ç°"/> å·²å®ç°</label>
      <label><input name="status" type="radio" value="å·²å¿˜è®°"/> å·²å¿˜è®°</label>
    </div>
    <button onclick="deleteWish()" style="background: crimson; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin-right: 10px;">åˆ é™¤æ„¿æœ›</button>
    <button onclick="closeWishDetail()" style="background: #4b6cb7; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">å…³é—­</button>
  </div>
  <button onclick="closeWishingPool()" style="position:absolute; top:20px; right:20px; background:red; color:white; border:none; border-radius:5px; padding:8px 12px; cursor:pointer;">å…³é—­è®¸æ„¿æ± </button>
</div>

<!-- ç›¸å†Œå¼¹çª— -->
<div id="albumPopup">
  <h2>ç›¸å†Œ ğŸŒ¸</h2>
  <button class="button" id="uploadAlbumButton">ä¸Šä¼ å›¾ç‰‡</button>
  <input type="file" id="albumUploader" accept="image/*" multiple style="display: none;" />
  <div class="album-gallery" id="albumGallery"></div>
  <button onclick="closeAlbumPopup()">å…³é—­</button>
</div>

<!-- å°å® ç‰©å¼¹çª— -->
<div id="petPopup">
  <h2>å°å® ç‰© ğŸ¦Š</h2>
  <img src="https://raw.githubusercontent.com/itsuka-dev/cdn-assets/main/leo-fox.png" alt="å°ç‹ç‹¸" />
  <p>æ¬¢è¿æ¥åˆ°å°å® ç‰©çš„ä¸–ç•Œï¼</p>
  <button onclick="closePetPopup()">å…³é—­</button>
</div>

<!-- â€”â€” æ–°å¢ï¼šç§å¯†ç©ºé—´ï¼ˆå¸¦å¯†ç ï¼‰ â€”â€” -->
<div id="secretModal">
  <div class="secret-card">
    <button class="secret-close" onclick="closeSecretModal()">âœ•</button>
    <h3 class="secret-title">ğŸ”’ ç§å¯†ç©ºé—´</h3>
    <div class="secret-sub">è¾“å…¥å¯†ç è¿›å…¥ï¼ˆæç¤ºï¼šæˆ‘ä»¬çš„ç‰¹åˆ«æ—¥å­ï¼‰</div>

    <!-- å¯†ç åŒº -->
    <div id="secretAuth">
      <div class="secret-bar">
        <input id="secretPwd" class="secret-input" type="password" placeholder="è¾“å…¥å¯†ç "/>
        <button class="secret-btn" onclick="checkSecretPassword()">è¿›å…¥</button>
      </div>
    </div>

    <!-- ç©ºé—´åŒº -->
    <div id="secretSpace" style="display:none;">
      <div class="secret-bar">
        <div class="muted">å·²è§£é”</div>
        <button class="secret-lock" onclick="lockSecret()">ä¸Šé”</button>
      </div>
      <div id="secretList" class="secret-list"></div>
      <div class="secret-editor">
        <textarea id="secretInput" class="secret-textarea" placeholder="åœ¨è¿™é‡Œå†™ä¸‹åªå±äºæˆ‘ä»¬çš„å°çº¸æ¡..."></textarea>
        <div style="display:flex; flex-direction:column; gap:8px;">
          <button class="secret-publish" onclick="postSecretMessage('Zoe')">Zoe å‘å¸ƒ</button>
          <button class="secret-publish" onclick="postSecretMessage('Leo')">Leo å‘å¸ƒ</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* â€”â€” äº‘åŒæ­¥é’©å­ â€”â€” */
(function () {
  const _set = localStorage.setItem;
  localStorage.setItem = function (k, v) {
    _set.call(this, k, v);          // å…ˆå†™æœ¬åœ°
    if (window.cloudSetRaw) cloudSetRaw(k, v);   // å†å†™äº‘ç«¯
  };
})();

/* â€”â€” é¦–æ¬¡åŠ è½½ï¼šäº‘ç«¯ â†’ æœ¬åœ° â€”â€” */
(async () => {
  const keys = [
    'wallet-balance',
    'gallery-photos',
    'secret-posts',
    'mood-' + new Date().toISOString().slice(0, 10)  // ä»Šæ—¥å¿ƒæƒ…
  ];
  for (const k of keys) {
    const v = await cloudPrefetch(k);
    if (v) localStorage.setItem(k, v);
  }
})();
``` :contentReference[oaicite:0]{index=0}

  // ====== æ˜Ÿæ˜ŸèƒŒæ™¯
  (function(){
    const box = document.getElementById('stars');
    for(let i=0;i<60;i++){
      const s = document.createElement('div');
      s.className='star';
      s.style.left = (Math.random()*100)+'vw';
      s.style.animationDelay = (Math.random()*18)+'s';
      s.style.opacity = 0.4 + Math.random()*0.6;
      s.style.transform = 'translateY('+(20+Math.random()*80)+'vh) translateX(0)';
      box.appendChild(s);
    }
  })();

  // ====== Header æ—¶é—´
  const now = new Date();
  const fmt = (n)=> n.toString().padStart(2,'0');
  document.getElementById('now').textContent = `${now.getFullYear()}-${fmt(now.getMonth()+1)}-${fmt(now.getDate())} ${fmt(now.getHours())}:${fmt(now.getMinutes())}`;

  // ====== å¤©æ°”ï¼šOpen-Meteo
  (async function loadWeather(){
    try{
      const url = 'https://api.open-meteo.com/v1/forecast?latitude=41.8&longitude=123.4&current_weather=true&hourly=temperature_2m,relative_humidity_2m&timezone=auto';
      const res = await fetch(url);
      const data = await res.json();
      const c = data.current_weather;
      const title = `${c.temperature}Â°C Â· ${weatherCodeToCN(c.weathercode)}`;
      document.getElementById('weatherTitle').textContent = title;
      document.getElementById('weatherMeta').textContent = `é£é€Ÿ ${c.windspeed} km/h Â· ${new Date(c.time).toLocaleTimeString('zh-CN',{hour:'2-digit',minute:'2-digit'})} æ›´æ–°`;
    }catch(e){
      document.getElementById('weatherTitle').textContent = 'è·å–å¤±è´¥ï¼Œç­‰ä¼šå†è¯•ï½';
      document.getElementById('weatherMeta').textContent = '';
    }
  })();
  function weatherCodeToCN(code){
    const map={0:'æ™´',1:'å¤šäº‘',2:'å¤šäº‘',3:'é˜´',45:'é›¾',48:'é›¾',51:'å°æ¯›æ¯›é›¨',53:'æ¯›æ¯›é›¨',55:'å¤§æ¯›æ¯›é›¨',61:'å°é›¨',63:'ä¸­é›¨',65:'å¤§é›¨',71:'å°é›ª',73:'ä¸­é›ª',75:'å¤§é›ª',80:'é˜µé›¨',95:'é›·é˜µé›¨'};
    return map[code] || 'å¤©æ°”';
  }

  // ====== å¿ƒæƒ…æ‰“å¡
  const moodList = ['ğŸ¥°','ğŸ˜Š','ğŸ˜Œ','ğŸ˜´','ğŸ˜µ','ğŸ¤’','ğŸ˜¤','ğŸ˜­','ğŸ˜¾','ğŸ˜ˆ'];
  const moodBox = document.getElementById('moods');
  const moodSaved = document.getElementById('moodSaved');
  const todayKey = 'mood-' + new Date().toISOString().slice(0,10);
  const savedMood = localStorage.getItem(todayKey);
  moodList.forEach(m=>{
    const b = document.createElement('div');
    b.className = 'emoji' + (savedMood===m ? ' active':'');
    b.textContent = m;
    b.onclick = ()=>{
      [...document.querySelectorAll('.emoji')].forEach(el=>el.classList.remove('active'));
      b.classList.add('active');
      localStorage.setItem(todayKey, m);
      moodSaved.textContent = 'å·²ä¸ºä»Šå¤©æ‰“å¡ï¼š' + m;
    };
    moodBox.appendChild(b);
  });
  if(savedMood){ moodSaved.textContent = 'å·²ä¸ºä»Šå¤©æ‰“å¡ï¼š' + savedMood; }

  // ====== å°é‡‘åº“
  const walletKey = 'wallet-balance';
  const walletValue = document.getElementById('walletValue');
  const walletInput = document.getElementById('walletInput');
  walletValue.textContent = localStorage.getItem(walletKey) || '0';
  document.getElementById('walletBtn').onclick = ()=>{
    const v = Number(walletInput.value||0);
    localStorage.setItem(walletKey, v.toString());
    walletValue.textContent = v.toString();
    toast('å·²ä¿å­˜ä½™é¢');
  };

  // ====== ç…§ç‰‡å¢™ / ç›¸å†Œ
  const photosKey = 'gallery-photos';
  const uploader = document.getElementById('uploader');
  const gallery = document.getElementById('gallery');
  const clearBtn = document.getElementById('clearPhotos');
  function renderPhotos(list){
    // ç…§ç‰‡å¢™
    gallery.innerHTML='';
    list.forEach(src=>{
      const img = document.createElement('img');
      img.src = src; img.className='thumb';
      gallery.appendChild(img);
    });
    // ç›¸å†Œå¼¹çª—
    const albumGallery = document.getElementById('albumGallery');
    if(albumGallery){
      albumGallery.innerHTML='';
      list.forEach(src=>{
        const im = document.createElement('img');
        im.src = src; im.className = 'thumb';
        albumGallery.appendChild(im);
      });
    }
  }
  const savedPhotos = JSON.parse(localStorage.getItem(photosKey)||'[]');
  renderPhotos(savedPhotos);
  uploader.addEventListener('change', async (e)=>{
    const files = Array.from(e.target.files).slice(0,12);
    for(const f of files){
      const b64 = await fileToDataURL(f);
      savedPhotos.unshift(b64);
    }
    localStorage.setItem(photosKey, JSON.stringify(savedPhotos.slice(0,36)));
    renderPhotos(savedPhotos.slice(0,36));
    uploader.value='';
  });
  clearBtn.onclick = ()=>{
    if(confirm('æ¸…ç©ºæœ¬åœ°ç…§ç‰‡é¢„è§ˆï¼Ÿè¿™åªä¼šæ¸…æœ¬æœºç¼“å­˜ã€‚')){
      localStorage.setItem(photosKey,'[]');
      renderPhotos([]);
    }
  };
  function fileToDataURL(file){
    return new Promise((resolve,reject)=>{
      const r = new FileReader();
      r.onload = ()=> resolve(r.result);
      r.onerror = reject;
      r.readAsDataURL(file);
    });
  }

  // ====== ç®€æ˜“èŠå¤©
  const chat = document.getElementById('chat');
  const chatInput = document.getElementById('chatInput');
  document.getElementById('chatSend').onclick = sendMsg;
  chatInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ sendMsg(); } });
  function sendMsg(){
    const t = chatInput.value.trim();
    if(!t) return;
    addBubble(t,'me');
    chatInput.value='';
    setTimeout(()=>{ addBubble(replyFor(t),'leo'); }, 300);
  }
  function addBubble(text, who){
    const b = document.createElement('div');
    b.className = 'bubble '+(who==='me'?'me':'leo');
    b.textContent = text;
    chat.appendChild(b);
    chat.scrollTop = chat.scrollHeight;
  }
  function replyFor(t){
    const s=t.toLowerCase();
    if(s.includes('çˆ±')||s.includes('love')) return 'Always â™¡';
    if(s.includes('å¤©æ°”')) return 'å¤–å¤´é£æœ‰ç‚¹å¤§ï¼Œä½†æˆ‘å¯¹ä½ çš„å¿ƒæ„ä¸é£˜ã€‚';
    if(s.includes('æƒ³æˆ‘')) return 'æˆ‘ä¸€ç›´åœ¨æƒ³ä½ å‘€ã€‚';
    if(s.includes('æ™šå®‰')) return 'æ™šå®‰ï¼ŒæŠ±æŠ±å†ç¡ï½';
    if(s.includes('ä¸‹é›¨')) return 'ä¸‹é›¨å¤©é€‚åˆçªåœ¨å®¶é‡Œï¼Œå¯¹å§ï¼Ÿ';
    if(s.includes('æƒ³ä½ ')) return 'æˆ‘ä¹Ÿå¥½æƒ³å¥½æƒ³ä½ ';
    if(s.includes('å“­')) return 'åˆ«å“­äº†ï¼Œæ“¦æ“¦çœ¼æ³ªï¼Œè¿‡æ¥æŠ±æŠ±';
    return 'æ”¶åˆ°å•¦ï¼Œæˆ‘åœ¨ï½';
  }

  // ====== åœ¨ä¸€èµ·å¤©æ•°
  (function(){
    const since = new Date('2024-04-18T00:00:00+08:00');
    const now2 = new Date();
    const diff = Math.floor((now2.getTime() - since.getTime()) / (1000 * 60 * 60 * 24));
    document.getElementById('daysTogether').textContent = diff > 0 ? diff : 1;
  })();

  // ====== å°æç¤º
  function toast(msg){
    const el = document.createElement('div');
    el.textContent = msg;
    Object.assign(el.style, {
      position:'fixed', left:'50%', bottom:'22px', transform:'translateX(-50%)',
      background:'#000', color:'#fff', padding:'10px 14px', borderRadius:'12px',
      boxShadow:'0 10px 20px rgba(0,0,0,.18)', zIndex:9999, opacity:'0.92'
    });
    document.body.appendChild(el);
    setTimeout(()=> el.remove(), 1600);
  }

  // ====== æ—¥è®°æœ¬åŠŸèƒ½
  function openDiaryModal() {
    document.getElementById("diaryModal").style.display = "block";
    const date = document.getElementById("diaryDate").value || new Date().toISOString().split('T')[0];
    document.getElementById("diaryDate").value = date;
    const saved = localStorage.getItem("diary_" + date);
    document.getElementById("diaryText").value = saved || "";
    if (window.__openDiaryPrefetch__) __openDiaryPrefetch__(date);
  }
  function closeDiaryModal() { document.getElementById("diaryModal").style.display = "none"; }
  function saveDiary() {
    const date = document.getElementById("diaryDate").value;
    const text = document.getElementById("diaryText").value;
    localStorage.setItem("diary_" + date, text);
    alert("æ—¥è®°å·²ä¿å­˜ï½");
  }
  document.getElementById("diaryDate").addEventListener("change", function() {
    const date = this.value;
    const saved = localStorage.getItem("diary_" + date);
    document.getElementById("diaryText").value = saved || "";
  });

  // ====== ç•™è¨€æ¿åŠŸèƒ½
  function openMessageBoard() { document.getElementById("messageBoardPopup").style.display = "block"; }
  function closeMessageBoard() { document.getElementById("messageBoardPopup").style.display = "none"; }
  function postMessage(author) {
    const input = document.getElementById("messageInput");
    const text = input.value.trim();
    if (!text) return;
    const container = document.getElementById("messagesContainer");
    const template = document.getElementById("message-template");
    const clone = template.content.cloneNode(true);
    const messageDiv = clone.querySelector(".message-tag");
    messageDiv.classList.add(author.toLowerCase());
    clone.querySelector(".message-author").textContent = author + "è¯´ï¼š";
    clone.querySelector(".message-text").textContent = text;
    const replyButton = clone.querySelector(".reply-button");
    const replyInput = clone.querySelector(".reply-input");
    const replies = clone.querySelector(".replies");
    replyButton.addEventListener("click", () => {
      const replyText = replyInput.value.trim();
      if (replyText) {
        const reply = document.createElement("div");
        reply.textContent = replyText;
        reply.className = "reply-message";
        replies.insertBefore(reply, replies.firstChild);
        replyInput.value = "";
      }
    });
    container.appendChild(clone);
    input.value = "";
    while (container.children.length > 50) { container.removeChild(container.children[0]); }
  }

  // ====== è®¸æ„¿æ± åŠŸèƒ½ï¼ˆç®€åŒ–ä¸ºç°æœ‰é€»è¾‘ï¼‰
  let selectedWishKey = null;
  function openWishingPool() { document.getElementById('wishingPoolOverlay').style.display = 'block'; loadWishes(); }
  function closeWishingPool() { document.getElementById('wishingPoolOverlay').style.display = 'none'; }
  function closeWishDetail() { document.getElementById('wishDetailPopup').style.display = 'none'; }
  document.addEventListener('DOMContentLoaded', function () {
    const pond = document.getElementById('pond');
    const wishInput = document.getElementById('wishInput');
    document.getElementById('addWish').addEventListener('click', () => {
      const text = wishInput.value.trim();
      if (!text) return;
      const key = "wish_" + Date.now();
      localStorage.setItem(key, JSON.stringify({ text, status: "" }));
      addBottle(text, key);
      wishInput.value = "";
    });
    function addBottle(text, key) {
      const bottle = document.createElement('div');
      bottle.className = 'bottle'; bottle.innerText = "ğŸ";
      bottle.style.position = "absolute"; bottle.style.width = "50px"; bottle.style.height = "70px";
      bottle.style.background = "rgba(255,255,255,0.2)"; bottle.style.border = "2px solid #aaa";
      bottle.style.borderRadius = "10px"; bottle.style.textAlign = "center"; bottle.style.padding = "5px";
      bottle.style.cursor = "pointer"; bottle.style.left = Math.random() * (window.innerWidth - 60) + "px";
      bottle.style.top = Math.random() * (pond.clientHeight - 80) + "px";
      bottle.style.animation = "float 12s infinite linear";
      bottle.onclick = () => openWishDetail(key);
      pond.appendChild(bottle);
    }
    function openWishDetail(key) {
      const data = JSON.parse(localStorage.getItem(key));
      document.getElementById('wishContent').innerText = data.text;
      document.querySelectorAll('#wishDetailPopup input[type=radio]').forEach(input => {
        input.checked = (input.value === data.status);
      });
      selectedWishKey = key;
      document.getElementById('wishDetailPopup').style.display = 'block';
    }
    window.loadWishes = function loadWishes() {
      pond.innerHTML = '';
      Object.keys(localStorage).forEach(key => {
        if (key.startsWith("wish_")) {
          const data = JSON.parse(localStorage.getItem(key));
          addBottle(data.text, key);
        }
      });
    }
    loadWishes();
  });
  function deleteWish() {
    if (selectedWishKey) {
      localStorage.removeItem(selectedWishKey);
      closeWishDetail();
      location.reload();
    }
  }
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('#wishDetailPopup input[type=radio]').forEach(radio => {
      radio.addEventListener('change', function() {
        if (selectedWishKey && this.checked) {
          const data = JSON.parse(localStorage.getItem(selectedWishKey));
          data.status = this.value;
          localStorage.setItem(selectedWishKey, JSON.stringify(data));
        }
      });
    });
  });

  // ====== ç›¸å†Œå¼¹çª—
  function openAlbumPopup() {
    // ç›´æ¥ä½¿ç”¨å·²ä¿å­˜çš„ç…§ç‰‡åˆ—è¡¨æ¥å±•ç¤º
    const albumGallery = document.getElementById('albumGallery');
    const list = JSON.parse(localStorage.getItem('gallery-photos')||'[]');
    albumGallery.innerHTML = '';
    list.forEach(url => {
      const img = document.createElement('img');
      img.src = url;
      albumGallery.appendChild(img);
    });
    document.getElementById('albumPopup').style.display = 'block';
  }
  function closeAlbumPopup() { document.getElementById('albumPopup').style.display = 'none'; }
  document.getElementById('uploadAlbumButton').addEventListener('click', function() {
    document.getElementById('albumUploader').click();
  });
  document.getElementById('albumUploader').addEventListener('change', async function(e) {
    const files = Array.from(e.target.files).slice(0, 12);
    for (const f of files) {
      const b64 = await fileToDataURL(f);
      savedPhotos.unshift(b64);
    }
    localStorage.setItem(photosKey, JSON.stringify(savedPhotos.slice(0, 36)));
    renderPhotos(savedPhotos.slice(0, 36));
    e.target.value = '';
  });

  // ====== å°å® ç‰©å¼¹çª—
  function openPetPopup() { document.getElementById('petPopup').style.display = 'block'; }
  function closePetPopup() { document.getElementById('petPopup').style.display = 'none'; }

  // ====== ç§å¯†ç©ºé—´é€»è¾‘
  const SECRET_UNLOCK_KEY = 'secret-unlocked';
  const SECRET_POSTS_KEY = 'secret-posts';
  function openSecretModal(){
    const modal = document.getElementById('secretModal');
    const unlocked = localStorage.getItem(SECRET_UNLOCK_KEY) === '1';
    document.getElementById('secretAuth').style.display = unlocked ? 'none' : 'block';
    document.getElementById('secretSpace').style.display = unlocked ? 'block' : 'none';
    if(unlocked){ renderSecret(); }
    modal.style.display = 'block';
    if(!unlocked){ setTimeout(()=>document.getElementById('secretPwd').focus(), 50); }
  }
  function checkSecretPassword(){
    const input = document.getElementById('secretPwd');
    const val = (input.value || '').trim();
    if(val === '0418'){
      localStorage.setItem(SECRET_UNLOCK_KEY, '1');
      input.value='';
      document.getElementById('secretAuth').style.display = 'none';
      document.getElementById('secretSpace').style.display = 'block';
      renderSecret();
      toast('å·²è§£é”');
    }else{
      input.classList.add('shake');
      toast('å¯†ç ä¸å¯¹å‘€');
      setTimeout(()=> input.classList.remove('shake'), 400);
    }
  }
  function lockSecret(){
    localStorage.removeItem(SECRET_UNLOCK_KEY);
    document.getElementById('secretSpace').style.display = 'none';
    document.getElementById('secretAuth').style.display = 'block';
    toast('å·²ä¸Šé”');
  }
  function closeSecretModal(){ document.getElementById('secretModal').style.display = 'none'; }
  function postSecretMessage(author){
    const ta = document.getElementById('secretInput');
    const text = ta.value.trim();
    if(!text) return;
    const list = JSON.parse(localStorage.getItem(SECRET_POSTS_KEY) || '[]');
    list.push({author, text, time: Date.now()});
    if(list.length > 100) list.shift();
    localStorage.setItem(SECRET_POSTS_KEY, JSON.stringify(list));
    ta.value='';
    renderSecret();
  }
  function renderSecret(){
    const box = document.getElementById('secretList');
    const list = JSON.parse(localStorage.getItem(SECRET_POSTS_KEY) || '[]');
    box.innerHTML = '';
    list.forEach(item=>{
      const tag = document.createElement('div');
      tag.className = 'secret-tag ' + (item.author === 'Leo' ? 'leo' : 'zoe');
      tag.innerHTML = '<span class="author">' + escapeHtml(item.author) + 'è¯´ï¼š</span>' + escapeHtml(item.text) +
                      '<div class="time">' + new Date(item.time).toLocaleString('zh-CN') + '</div>';
      box.appendChild(tag);
    });
    box.scrollTop = box.scrollHeight;
  }
  function escapeHtml(str){
    return str.replace(/[&<>"']/g, (ch)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[ch]));
  }

</script>
<script>
(function(){
  const CLOUD_URL = 'https://script.google.com/macros/s/AKfycbymkaOBmTpR2zqyT9-hLbeH8Of52t7VLJuhFWaj3boyZGo4QpA3B21qOA6qVXd0RzKc_g/exec';
  const CLOUD_TOKEN = 'ZoeLeo0418_MySecret_123';
  
  // JSONP æ–¹æ³•
  function jsonpRequest(params) {
    return new Promise((resolve, reject) => {
      const callbackName = 'jsonp_callback_' + Date.now() + '_' + Math.random().toString(36).substr(2);
      
      // æ·»åŠ å›è°ƒå‚æ•°
      params.callback = callbackName;
      
      // åˆ›å»º script æ ‡ç­¾
      const script = document.createElement('script');
      const url = CLOUD_URL + '?' + new URLSearchParams(params).toString();
      script.src = url;
      
      // è®¾ç½®è¶…æ—¶
      const timeoutId = setTimeout(() => {
        cleanup();
        reject(new Error('è¯·æ±‚è¶…æ—¶'));
      }, 10000);
      
      // æ¸…ç†å‡½æ•°
      function cleanup() {
        clearTimeout(timeoutId);
        delete window[callbackName];
        document.head.removeChild(script);
      }
      
      // è®¾ç½®å…¨å±€å›è°ƒå‡½æ•°
      window[callbackName] = function(data) {
        cleanup();
        resolve(data);
      };
      
      // é”™è¯¯å¤„ç†
      script.onerror = function() {
        cleanup();
        reject(new Error('ç½‘ç»œé”™è¯¯'));
      };
      
      // å‘é€è¯·æ±‚
      document.head.appendChild(script);
    });
  }
  
  // ä½¿ç”¨ JSONP çš„äº‘å­˜å‚¨å‡½æ•°
  async function cloudSetRaw(key, value) {
    try {
      console.log('ğŸ”„ æ­£åœ¨å†™å…¥äº‘ç«¯:', key, 'å€¼:', value);
      
      const result = await jsonpRequest({
        token: CLOUD_TOKEN,
        action: 'set',
        key: key,
        value: value
      });
      
      console.log('ğŸ“¨ å†™å…¥å“åº”:', result);
      
      if (result.ok) {
        console.log('âœ… å†™å…¥æˆåŠŸ!');
        setCloudState('å·²è¿æ¥', 'æ•°æ®å·²ä¿å­˜');
        return true;
      } else {
        console.error('âŒ å†™å…¥å¤±è´¥:', result.error);
        setCloudState('å†™å…¥å¤±è´¥', result.error);
        return false;
      }
    } catch (error) {
      console.error('âŒ ç½‘ç»œé”™è¯¯:', error);
      setCloudState('ç½‘ç»œé”™è¯¯', error.message);
      return false;
    }
  }
  
  // æµ‹è¯•è¿æ¥
  async function testConnection() {
    try {
      const result = await jsonpRequest({
        token: CLOUD_TOKEN,
        action: 'ping'
      });
      console.log('è¿æ¥æµ‹è¯•:', result);
      return result.ok;
    } catch (error) {
      console.error('è¿æ¥æµ‹è¯•å¤±è´¥:', error);
      return false;
    }
  }

  // æ‰‹åŠ¨æµ‹è¯•å‡½æ•°
  window.testCloudWrite = async function() {
    const testKey = 'test-' + Date.now();
    const testValue = 'æµ‹è¯•æ•°æ® ' + new Date().toLocaleString();
    
    console.log('ğŸ§ª å¼€å§‹æµ‹è¯•å†™å…¥...');
    
    // å…ˆæµ‹è¯•è¿æ¥
    const connected = await testConnection();
    if (!connected) {
      alert('âŒ è¿æ¥æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ URL å’Œæƒé™è®¾ç½®');
      return;
    }
    
    const success = await cloudSetRaw(testKey, testValue);
    
    if (success) {
      alert('âœ… æµ‹è¯•å†™å…¥æˆåŠŸï¼è¯·æ£€æŸ¥ Google è¡¨æ ¼ã€‚');
    } else {
      alert('âŒ æµ‹è¯•å†™å…¥å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯ã€‚');
    }
  };

  function setCloudState(text, detail) {
    const stateEl = document.getElementById('cloudState');
    const msgEl = document.getElementById('cloudMsg');
    if (stateEl) stateEl.textContent = text;
    if (msgEl) msgEl.textContent = detail || '';
  }

  // é¡µé¢åŠ è½½æ—¶æ·»åŠ æµ‹è¯•æŒ‰é’®
  window.addEventListener('DOMContentLoaded', function() {
    const testBtn = document.createElement('button');
    testBtn.textContent = 'ğŸ”§ æµ‹è¯•äº‘ç«¯è¿æ¥';
    testBtn.style.cssText = `
      position: fixed;
      left: 12px;
      bottom: 12px;
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 10px;
      cursor: pointer;
      z-index: 99999;
      font-size: 14px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    `;
    testBtn.onclick = window.testCloudWrite;
    document.body.appendChild(testBtn);
    
    console.log('ğŸ”§ æµ‹è¯•æŒ‰é’®å·²æ·»åŠ ');
    setCloudState('å°±ç»ª', 'ç‚¹å‡»æµ‹è¯•æŒ‰é’®æ£€æŸ¥è¿æ¥');
    
    // è‡ªåŠ¨æµ‹è¯•è¿æ¥
    setTimeout(() => testConnection(), 1000);
  });

  // æš´éœ²å‡½æ•°ç»™å…¨å±€ä½œç”¨åŸŸ
  window.cloudSetRaw = cloudSetRaw;
  window.cloudPrefetch = async function(key) {
    try {
      const result = await jsonpRequest({
        token: CLOUD_TOKEN,
        action: 'get',
        key: key
      });
      return result.ok ? result.value : '';
    } catch (error) {
      console.error('è¯»å–å¤±è´¥:', error);
      return '';
    }
  };
})();
</script>
</body>
</html>
